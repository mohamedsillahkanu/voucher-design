<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voucher Designer Pro | ITN Mass Campaign</title>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --brand-navy: #004080;
            --brand-blue: #0056b3;
            --brand-gold: #ffc107;
            --brand-light: #f7f9fc;
            --brand-gray: #6b7c93;
            --shadow-sm: 0 1px 3px rgba(0,64,128,0.08);
            --shadow-md: 0 4px 12px rgba(0,64,128,0.12);
            --shadow-lg: 0 8px 30px rgba(0,64,128,0.16);
            --radius-sm: 6px;
            --radius-md: 10px;
            --radius-lg: 16px;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #f0f4f8 0%, #e8eef5 100%);
            min-height: 100vh;
            color: var(--brand-navy);
            line-height: 1.5;
        }
        
        .app-container {
            max-width: 1440px;
            margin: 0 auto;
            padding: 24px;
        }
        
        /* Header */
        .app-header {
            background: linear-gradient(135deg, #004080 0%, #002855 100%);
            border-radius: var(--radius-lg);
            padding: 32px 40px;
            margin-bottom: 24px;
            position: relative;
            overflow: hidden;
        }
        
        .app-header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -10%;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(255,193,7,0.15) 0%, transparent 70%);
            pointer-events: none;
        }
        
        .header-content {
            display: flex;
            align-items: center;
            gap: 24px;
            position: relative;
            z-index: 1;
        }
        
        .header-logos {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .logo-box {
            width: 64px;
            height: 64px;
            background: white;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Playfair Display', serif;
            font-weight: 700;
            font-size: 20px;
            color: var(--brand-navy);
            box-shadow: var(--shadow-md);
        }
        
        .header-text {
            flex: 1;
        }
        
        .header-text h1 {
            font-family: 'Playfair Display', serif;
            font-size: 28px;
            font-weight: 700;
            color: white;
            margin-bottom: 4px;
            letter-spacing: -0.5px;
        }
        
        .header-text .subtitle {
            font-size: 13px;
            color: rgba(255,255,255,0.8);
            font-weight: 500;
        }
        
        .header-text .tagline {
            font-size: 11px;
            color: var(--brand-gold);
            font-style: italic;
            margin-top: 2px;
        }
        
        /* Main Layout */
        .main-layout {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 24px;
        }
        
        @media (max-width: 1100px) {
            .main-layout { grid-template-columns: 1fr; }
        }
        
        /* Cards */
        .card {
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            overflow: hidden;
        }
        
        .card-header {
            background: var(--brand-light);
            padding: 16px 20px;
            border-bottom: 1px solid #e5e9f0;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .card-icon {
            width: 32px;
            height: 32px;
            background: var(--brand-navy);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            font-weight: 700;
        }
        
        .card-title {
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--brand-navy);
        }
        
        .card-body {
            padding: 20px;
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            gap: 4px;
            background: var(--brand-light);
            padding: 4px;
            border-radius: var(--radius-md);
            margin-bottom: 20px;
        }
        
        .tab {
            flex: 1;
            padding: 10px 16px;
            background: transparent;
            border: none;
            border-radius: var(--radius-sm);
            font-family: 'DM Sans', sans-serif;
            font-size: 13px;
            font-weight: 600;
            color: var(--brand-gray);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .tab:hover {
            color: var(--brand-navy);
        }
        
        .tab.active {
            background: white;
            color: var(--brand-navy);
            box-shadow: var(--shadow-sm);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Form Elements */
        .form-section {
            margin-bottom: 20px;
        }
        
        .section-label {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--brand-light);
        }
        
        .section-number {
            width: 22px;
            height: 22px;
            background: var(--brand-blue);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 700;
        }
        
        .section-text {
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--brand-navy);
        }
        
        .form-group {
            margin-bottom: 14px;
        }
        
        .form-label {
            display: block;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            color: var(--brand-gray);
            margin-bottom: 6px;
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e5e9f0;
            border-radius: var(--radius-sm);
            font-family: 'DM Sans', sans-serif;
            font-size: 13px;
            color: var(--brand-navy);
            background: white;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--brand-blue);
            box-shadow: 0 0 0 3px rgba(0,82,204,0.1);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        
        /* Logo Upload */
        .logo-upload-area {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .logo-preview-box {
            width: 56px;
            height: 56px;
            border: 2px dashed #004080;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--brand-light);
            overflow: hidden;
            flex-shrink: 0;
            transition: all 0.2s;
        }
        
        .logo-preview-box.has-logo {
            border-style: solid;
            border-color: var(--brand-blue);
        }
        
        .logo-preview-box img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        .logo-placeholder {
            color: #004080;
            font-size: 9px;
            text-align: center;
            line-height: 1.3;
            font-weight: 600;
        }
        
        .logo-placeholder small {
            display: block;
            font-size: 7px;
            color: #6b7c93;
            font-weight: 500;
        }
        
        /* Upload Zone */
        .upload-zone {
            border: 2px dashed #d1d9e6;
            border-radius: var(--radius-md);
            padding: 28px 20px;
            text-align: center;
            background: var(--brand-light);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .upload-zone:hover {
            border-color: var(--brand-blue);
            background: #f0f6ff;
        }
        
        .upload-zone.dragover {
            border-color: var(--brand-blue);
            background: #e6f0ff;
        }
        
        .upload-icon {
            width: 48px;
            height: 48px;
            margin: 0 auto 12px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-sm);
        }
        
        .upload-icon svg {
            width: 24px;
            height: 24px;
            stroke: var(--brand-blue);
        }
        
        .upload-text {
            font-size: 13px;
            color: var(--brand-gray);
        }
        
        .upload-text strong {
            color: var(--brand-blue);
        }
        
        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px 18px;
            border-radius: var(--radius-sm);
            font-family: 'DM Sans', sans-serif;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }
        
        .btn-primary {
            background: var(--brand-navy);
            color: white;
        }
        
        .btn-primary:hover {
            background: #0d2d4a;
        }
        
        .btn-secondary {
            background: white;
            color: var(--brand-navy);
            border: 2px solid #e5e9f0;
        }
        
        .btn-secondary:hover {
            border-color: var(--brand-navy);
        }
        
        .btn-success {
            background: #0d9f6e;
            color: white;
        }
        
        .btn-success:hover {
            background: #0b8a5e;
        }
        
        .btn-gold {
            background: linear-gradient(135deg, var(--brand-gold) 0%, #c49510 100%);
            color: white;
        }
        
        .btn-gold:hover {
            background: linear-gradient(135deg, #c49510 0%, #b08a0e 100%);
        }
        
        .btn-block {
            width: 100%;
        }
        
        .btn svg {
            width: 16px;
            height: 16px;
        }
        
        /* Template Selector */
        .template-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
        }
        
        .template-btn {
            padding: 8px 6px;
            border: 2px solid #e5e9f0;
            background: white;
            border-radius: var(--radius-sm);
            font-family: 'DM Sans', sans-serif;
            font-size: 10px;
            font-weight: 600;
            color: var(--brand-gray);
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }
        
        .template-btn:hover {
            border-color: var(--brand-blue);
            color: var(--brand-blue);
        }
        
        .template-btn.active {
            background: var(--brand-navy);
            border-color: var(--brand-navy);
            color: white;
        }
        
        /* Color Picker */
        .color-row {
            display: flex;
            gap: 16px;
            align-items: center;
        }
        
        .color-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .color-picker {
            width: 36px;
            height: 36px;
            padding: 2px;
            border: 2px solid #e5e9f0;
            border-radius: var(--radius-sm);
            cursor: pointer;
            background: white;
        }
        
        .color-picker::-webkit-color-swatch-wrapper {
            padding: 2px;
        }
        
        .color-picker::-webkit-color-swatch {
            border: none;
            border-radius: 3px;
        }
        
        .color-label {
            font-size: 11px;
            font-weight: 600;
            color: var(--brand-gray);
            text-transform: uppercase;
        }
        
        /* Data Preview */
        .data-preview {
            max-height: 180px;
            overflow-y: auto;
            border: 1px solid #e5e9f0;
            border-radius: var(--radius-sm);
            margin-top: 12px;
        }
        
        .data-preview table {
            width: 100%;
            border-collapse: collapse;
            font-size: 10px;
        }
        
        .data-preview th, .data-preview td {
            padding: 8px 10px;
            border-bottom: 1px solid #f0f4f8;
            text-align: left;
        }
        
        .data-preview th {
            background: var(--brand-navy);
            color: white;
            position: sticky;
            top: 0;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }
        
        .data-preview tr:hover td {
            background: #f7f9fc;
        }
        
        .data-count {
            background: linear-gradient(135deg, #e6f0ff 0%, #f0f6ff 100%);
            padding: 12px 16px;
            border-radius: var(--radius-sm);
            margin-top: 12px;
            font-size: 13px;
            color: var(--brand-navy);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .data-count strong {
            color: var(--brand-blue);
        }
        
        /* Preview Section */
        .preview-card {
            position: sticky;
            top: 24px;
        }
        
        .preview-area {
            background: linear-gradient(45deg, #e8eef5 25%, transparent 25%),
                        linear-gradient(-45deg, #e8eef5 25%, transparent 25%),
                        linear-gradient(45deg, transparent 75%, #e8eef5 75%),
                        linear-gradient(-45deg, transparent 75%, #e8eef5 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            background-color: #f7f9fc;
            padding: 30px;
            border-radius: var(--radius-md);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 220px;
        }
        
        .download-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .download-buttons .btn {
            flex: 1;
        }
        
        /* Progress Bar */
        .progress-container {
            margin-top: 16px;
            display: none;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e5e9f0;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--brand-blue) 0%, var(--brand-gold) 100%);
            transition: width 0.3s;
            border-radius: 4px;
        }
        
        .progress-text {
            font-size: 11px;
            color: var(--brand-gray);
            margin-top: 8px;
            text-align: center;
        }
        
        /* ==================== VOUCHER STYLES ==================== */
        .voucher {
            width: 280px;
            height: 160px;
            position: relative;
            font-family: 'DM Sans', sans-serif;
            overflow: hidden;
        }
        
        /* Header with logo - positioned at top for all templates */
        .voucher-header {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
        }
        
        .voucher-logo {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            overflow: hidden;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .voucher-logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        .voucher-institution {
            font-size: 7px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            line-height: 1.2;
        }
        
        .voucher-body {
            padding: 0 12px 8px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .voucher-title {
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }
        
        .voucher-name {
            font-size: 16px;
            font-weight: 700;
            line-height: 1.1;
            margin-bottom: 4px;
        }
        
        .voucher-desc {
            font-size: 7px;
            margin-bottom: 4px;
            opacity: 0.85;
        }
        
        .voucher-footer {
            font-size: 6px;
            display: flex;
            justify-content: space-between;
            gap: 8px;
            margin-top: auto;
            opacity: 0.7;
        }
        
        .voucher-qr {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 8px;
        }
        
        .qr-wrapper {
            padding: 4px;
            background: white;
            border-radius: 4px;
        }
        
        .qr-code-container {
            width: 50px;
            height: 50px;
        }
        
        .qr-code-container img, .qr-code-container canvas {
            width: 50px !important;
            height: 50px !important;
        }
        
        .qr-label {
            font-size: 5px;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            margin-top: 4px;
            font-weight: 600;
        }
        
        .voucher-code {
            font-size: 6px;
            font-weight: 700;
            margin-top: 2px;
        }
        
        /* ==================== TEMPLATE STYLES ==================== */
        
        /* 1. Classic - Clean gradient */
        .voucher.template-classic {
            background: linear-gradient(135deg, var(--primary-color) 0%, color-mix(in srgb, var(--primary-color) 70%, #000) 100%);
            border-radius: 10px;
            display: grid;
            grid-template-columns: 1fr 75px;
            grid-template-rows: auto 1fr;
            color: white;
        }
        .voucher.template-classic .voucher-header { grid-column: 1 / -1; border-bottom: 1px solid rgba(255,255,255,0.15); }
        .voucher.template-classic .voucher-logo { background: white; }
        .voucher.template-classic .voucher-qr { background: rgba(255,255,255,0.1); border-radius: 0 0 10px 0; }
        .voucher.template-classic .qr-label, .voucher.template-classic .voucher-code { color: rgba(255,255,255,0.85); }
        
        /* 2. Modern - White card with accent */
        .voucher.template-modern {
            background: white;
            border: 2px solid var(--primary-color);
            border-radius: 10px;
            display: grid;
            grid-template-columns: 1fr 75px;
            grid-template-rows: auto 1fr;
            color: #333;
        }
        .voucher.template-modern .voucher-header { grid-column: 1 / -1; background: var(--primary-color); color: white; }
        .voucher.template-modern .voucher-logo { background: white; }
        .voucher.template-modern .voucher-title { color: var(--primary-color); }
        .voucher.template-modern .voucher-name { color: var(--primary-color); }
        .voucher.template-modern .voucher-qr { background: #f8f9fa; border-left: 1px dashed #ddd; }
        .voucher.template-modern .qr-label { color: var(--primary-color); }
        .voucher.template-modern .voucher-code { color: var(--primary-color); }
        
        /* 3. Elegant - Dark sophisticated */
        .voucher.template-elegant {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 10px;
            display: grid;
            grid-template-columns: 1fr 75px;
            grid-template-rows: auto 1fr;
            color: white;
        }
        .voucher.template-elegant .voucher-header { grid-column: 1 / -1; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .voucher.template-elegant .voucher-logo { background: white; }
        .voucher.template-elegant .voucher-institution { color: rgba(255,255,255,0.7); }
        .voucher.template-elegant .voucher-title { color: var(--secondary-color); }
        .voucher.template-elegant .voucher-name { background: linear-gradient(90deg, var(--primary-color), var(--secondary-color)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .voucher.template-elegant .voucher-qr { background: rgba(255,255,255,0.05); }
        .voucher.template-elegant .qr-label { color: rgba(255,255,255,0.6); }
        .voucher.template-elegant .voucher-code { color: var(--secondary-color); }
        
        /* 4. Corporate - Professional header bar */
        .voucher.template-corporate {
            background: white;
            border-radius: 8px;
            display: grid;
            grid-template-columns: 1fr 75px;
            grid-template-rows: auto 1fr;
            color: #333;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }
        .voucher.template-corporate .voucher-header { grid-column: 1 / -1; background: var(--primary-color); color: white; }
        .voucher.template-corporate .voucher-logo { background: white; }
        .voucher.template-corporate .voucher-body { border-bottom: 3px solid var(--primary-color); }
        .voucher.template-corporate .voucher-title { color: #666; font-weight: 500; }
        .voucher.template-corporate .voucher-name { color: var(--primary-color); }
        .voucher.template-corporate .voucher-qr { background: #fafafa; }
        .voucher.template-corporate .qr-label, .voucher.template-corporate .voucher-code { color: var(--primary-color); }
        
        /* 5. Minimal - Clean and simple */
        .voucher.template-minimal {
            background: #fafafa;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            display: grid;
            grid-template-columns: 1fr 75px;
            grid-template-rows: auto 1fr;
            color: #333;
        }
        .voucher.template-minimal .voucher-header { grid-column: 1 / -1; border-bottom: 1px solid #e8e8e8; }
        .voucher.template-minimal .voucher-logo { border: 1px solid #ddd; }
        .voucher.template-minimal .voucher-institution { color: #888; }
        .voucher.template-minimal .voucher-title { color: #aaa; font-size: 8px; }
        .voucher.template-minimal .voucher-name { font-size: 18px; color: var(--primary-color); }
        .voucher.template-minimal .voucher-qr { border-left: 1px solid #e8e8e8; }
        .voucher.template-minimal .qr-label { color: #999; }
        .voucher.template-minimal .voucher-code { color: var(--primary-color); }
        
        /* 6. Health - Medical/NGO style */
        .voucher.template-health {
            background: linear-gradient(135deg, #2e7d32 0%, #1b5e20 100%);
            border-radius: 10px;
            display: grid;
            grid-template-columns: 1fr 75px;
            grid-template-rows: auto 1fr;
            color: white;
        }
        .voucher.template-health .voucher-header { grid-column: 1 / -1; background: rgba(255,255,255,0.1); }
        .voucher.template-health .voucher-logo { background: white; }
        .voucher.template-health .voucher-title { color: #a5d6a7; }
        .voucher.template-health .voucher-qr { background: rgba(255,255,255,0.95); border-radius: 0 0 10px 0; }
        .voucher.template-health .qr-label { color: #2e7d32; }
        .voucher.template-health .voucher-code { color: #1b5e20; }
        
        /* 7. Official - Government style */
        .voucher.template-official {
            background: white;
            border: 3px solid var(--primary-color);
            border-radius: 4px;
            display: grid;
            grid-template-columns: 1fr 75px;
            grid-template-rows: auto 1fr;
            color: #333;
        }
        .voucher.template-official .voucher-header { grid-column: 1 / -1; background: var(--primary-color); color: white; padding: 6px 12px; }
        .voucher.template-official .voucher-logo { background: white; border-radius: 2px; }
        .voucher.template-official .voucher-institution { font-size: 8px; }
        .voucher.template-official .voucher-title { color: var(--primary-color); border-bottom: 1px solid #ddd; padding-bottom: 4px; margin-bottom: 6px; }
        .voucher.template-official .voucher-name { color: #1a1a1a; }
        .voucher.template-official .voucher-qr { background: #f5f5f5; border-left: 2px solid var(--primary-color); }
        .voucher.template-official .qr-label, .voucher.template-official .voucher-code { color: var(--primary-color); }
        
        /* 8. Gradient - Colorful modern */
        .voucher.template-gradient {
            background: linear-gradient(135deg, var(--primary-color) 0%, #764ba2 50%, var(--secondary-color) 100%);
            border-radius: 12px;
            display: grid;
            grid-template-columns: 1fr 75px;
            grid-template-rows: auto 1fr;
            color: white;
        }
        .voucher.template-gradient .voucher-header { grid-column: 1 / -1; background: rgba(0,0,0,0.1); }
        .voucher.template-gradient .voucher-logo { background: white; }
        .voucher.template-gradient .voucher-qr { background: rgba(255,255,255,0.95); border-radius: 0 0 12px 0; }
        .voucher.template-gradient .qr-label { color: var(--primary-color); }
        .voucher.template-gradient .voucher-code { color: var(--primary-color); }
        
        /* 9. Campaign - Bold promotional */
        .voucher.template-campaign {
            background: var(--primary-color);
            border-radius: 10px;
            display: grid;
            grid-template-columns: 1fr 75px;
            grid-template-rows: auto 1fr;
            color: white;
            position: relative;
        }
        .voucher.template-campaign::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: var(--secondary-color);
            opacity: 0.2;
            border-radius: 0 10px 0 100%;
        }
        .voucher.template-campaign .voucher-header { grid-column: 1 / -1; position: relative; z-index: 1; }
        .voucher.template-campaign .voucher-logo { background: white; }
        .voucher.template-campaign .voucher-body { position: relative; z-index: 1; }
        .voucher.template-campaign .voucher-title { color: var(--secondary-color); }
        .voucher.template-campaign .voucher-qr { background: white; border-radius: 0 0 10px 0; position: relative; z-index: 1; }
        .voucher.template-campaign .qr-label { color: var(--primary-color); }
        .voucher.template-campaign .voucher-code { color: var(--primary-color); }
        
        /* 10. Badge - ID card style */
        .voucher.template-badge {
            background: linear-gradient(180deg, var(--primary-color) 0%, var(--primary-color) 35%, white 35%);
            border-radius: 10px;
            display: grid;
            grid-template-columns: 1fr 75px;
            grid-template-rows: auto 1fr;
            border: 2px solid var(--primary-color);
        }
        .voucher.template-badge .voucher-header { grid-column: 1 / -1; color: white; }
        .voucher.template-badge .voucher-logo { background: white; }
        .voucher.template-badge .voucher-body { color: #333; }
        .voucher.template-badge .voucher-title { color: var(--primary-color); }
        .voucher.template-badge .voucher-name { color: var(--primary-color); font-size: 15px; }
        .voucher.template-badge .voucher-qr { background: #f8f9fa; }
        .voucher.template-badge .qr-label, .voucher.template-badge .voucher-code { color: var(--primary-color); }
        
        /* 11. Premium - Luxury gold accents */
        .voucher.template-premium {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border: 1px solid #d4af37;
            border-radius: 4px;
            display: grid;
            grid-template-columns: 1fr 75px;
            grid-template-rows: auto 1fr;
            color: white;
        }
        .voucher.template-premium .voucher-header { grid-column: 1 / -1; border-bottom: 1px solid rgba(212,175,55,0.3); }
        .voucher.template-premium .voucher-logo { border: 1px solid #d4af37; background: transparent; }
        .voucher.template-premium .voucher-institution { color: #d4af37; }
        .voucher.template-premium .voucher-title { color: #d4af37; font-weight: 400; letter-spacing: 1px; }
        .voucher.template-premium .voucher-name { color: #d4af37; }
        .voucher.template-premium .voucher-qr { border-left: 1px solid rgba(212,175,55,0.3); }
        .voucher.template-premium .qr-label, .voucher.template-premium .voucher-code { color: #d4af37; }
        
        /* 12. Wave - Decorative pattern */
        .voucher.template-wave {
            background: var(--primary-color);
            border-radius: 10px;
            display: grid;
            grid-template-columns: 1fr 75px;
            grid-template-rows: auto 1fr;
            color: white;
            position: relative;
            overflow: hidden;
        }
        .voucher.template-wave::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 40px;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 120'%3E%3Cpath fill='rgba(255,255,255,0.1)' d='M321.39,56.44c58-10.79,114.16-30.13,172-41.86,82.39-16.72,168.19-17.73,250.45-.39C823.78,31,906.67,72,985.66,92.83c70.05,18.48,146.53,26.09,214.34,3V120H0V95.8C59.71,118.11,140.83,94.17,214.86,79.51,253.81,71.07,googletag.cmd.push(function() {
googletag.display('div-gpt-ad-1422003450156-4'); }); 282.78,61.79,321.39,56.44Z'%3E%3C/path%3E%3C/svg%3E") no-repeat bottom;
            background-size: cover;
            pointer-events: none;
        }
        .voucher.template-wave .voucher-header { grid-column: 1 / -1; position: relative; z-index: 1; background: rgba(0,0,0,0.1); }
        .voucher.template-wave .voucher-logo { background: white; }
        .voucher.template-wave .voucher-body { position: relative; z-index: 1; }
        .voucher.template-wave .voucher-qr { background: white; border-radius: 0 0 10px 0; position: relative; z-index: 1; }
        .voucher.template-wave .qr-label, .voucher.template-wave .voucher-code { color: var(--primary-color); }
        
        /* 13. Stripe - Diagonal accent */
        .voucher.template-stripe {
            background: white;
            border-radius: 10px;
            display: grid;
            grid-template-columns: 1fr 75px;
            grid-template-rows: auto 1fr;
            color: #333;
            position: relative;
            overflow: hidden;
        }
        .voucher.template-stripe::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 8px;
            height: 100%;
            background: repeating-linear-gradient(45deg, var(--primary-color), var(--primary-color) 4px, var(--secondary-color) 4px, var(--secondary-color) 8px);
        }
        .voucher.template-stripe .voucher-header { grid-column: 1 / -1; background: var(--primary-color); color: white; margin-left: 8px; }
        .voucher.template-stripe .voucher-logo { background: white; }
        .voucher.template-stripe .voucher-body { margin-left: 8px; }
        .voucher.template-stripe .voucher-title { color: var(--primary-color); }
        .voucher.template-stripe .voucher-name { color: var(--primary-color); }
        .voucher.template-stripe .voucher-qr { background: #f8f9fa; }
        .voucher.template-stripe .qr-label, .voucher.template-stripe .voucher-code { color: var(--primary-color); }
        
        /* 14. Split - Two-tone design */
        .voucher.template-split {
            background: linear-gradient(90deg, var(--primary-color) 50%, white 50%);
            border-radius: 10px;
            display: grid;
            grid-template-columns: 1fr 75px;
            grid-template-rows: auto 1fr;
            border: 2px solid var(--primary-color);
        }
        .voucher.template-split .voucher-header { grid-column: 1 / -1; background: var(--primary-color); color: white; }
        .voucher.template-split .voucher-logo { background: white; }
        .voucher.template-split .voucher-body { color: white; }
        .voucher.template-split .voucher-title { color: var(--secondary-color); }
        .voucher.template-split .voucher-qr { background: white; }
        .voucher.template-split .qr-label, .voucher.template-split .voucher-code { color: var(--primary-color); }
        
        /* 15. Rounded - Soft curves */
        .voucher.template-rounded {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            display: grid;
            grid-template-columns: 1fr 75px;
            grid-template-rows: auto 1fr;
            color: white;
        }
        .voucher.template-rounded .voucher-header { grid-column: 1 / -1; }
        .voucher.template-rounded .voucher-logo { background: white; border-radius: 8px; }
        .voucher.template-rounded .voucher-qr { background: white; border-radius: 0 0 20px 0; }
        .voucher.template-rounded .qr-label { color: #667eea; }
        .voucher.template-rounded .voucher-code { color: #764ba2; }
        
        /* Notification */
        .notification {
            position: fixed;
            top: 24px;
            left: 50%;
            transform: translateX(-50%);
            padding: 14px 24px;
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 13px;
            z-index: 2000;
            display: none;
            box-shadow: var(--shadow-lg);
        }
        
        .notification.success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #28a745;
            display: block;
        }
        
        .notification.error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #dc3545;
            display: block;
        }
        
        /* Footer */
        .app-footer {
            background: var(--brand-navy);
            color: white;
            padding: 24px 32px;
            border-radius: var(--radius-lg);
            margin-top: 24px;
            text-align: center;
        }
        
        .app-footer h4 {
            font-family: 'Playfair Display', serif;
            font-size: 16px;
            margin-bottom: 4px;
        }
        
        .app-footer p {
            font-size: 12px;
            opacity: 0.8;
            margin: 2px 0;
        }
        
        .app-footer .copyright {
            font-size: 10px;
            opacity: 0.6;
            margin-top: 8px;
        }
        
        /* Hidden render area */
        #renderArea {
            position: absolute;
            left: -9999px;
            top: 0;
        }
        
        /* SVG Icons */
        .icon {
            display: inline-block;
            width: 16px;
            height: 16px;
            vertical-align: middle;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <div class="header-logos">
                    <div class="logo-box">ICF</div>
                </div>
                <div class="header-text">
                    <h1>Voucher Designer Pro</h1>
                    <p class="subtitle">Informatics Consultancy Firm - Sierra Leone (ICF-SL)</p>
                    <p class="tagline">Driving Data-Driven Solutions for Health and Development</p>
                </div>
            </div>
        </header>
        
        <!-- Main Content -->
        <main class="main-layout">
            <!-- Left Panel - Controls -->
            <div class="controls-panel">
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">V</div>
                        <span class="card-title">Voucher Configuration</span>
                    </div>
                    <div class="card-body">
                        <!-- Tabs -->
                        <div class="tabs">
                            <button class="tab active" onclick="switchTab('single')">Single Voucher</button>
                            <button class="tab" onclick="switchTab('batch')">Batch from Excel</button>
                        </div>
                        
                        <!-- Single Voucher Tab -->
                        <div id="singleTab" class="tab-content active">
                            <div class="form-section">
                                <div class="section-label">
                                    <span class="section-number">1</span>
                                    <span class="section-text">Logo & Institution</span>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Upload Logo</label>
                                    <div class="logo-upload-area">
                                        <div class="logo-preview-box" id="logoPreviewBox">
                                            <span class="logo-placeholder" id="logoPlaceholder">LOGO<small>.png</small></span>
                                            <img id="logoPreviewImg" src="" alt="Logo" style="display: none;">
                                        </div>
                                        <div style="flex: 1;">
                                            <input type="file" id="logoUpload" accept="image/*" onchange="handleLogoUpload(event)" style="display: none;">
                                            <button class="btn btn-secondary btn-block" onclick="document.getElementById('logoUpload').click()">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12"/></svg>
                                                Select Logo
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Institution Name</label>
                                    <input type="text" class="form-input" id="companyName" oninput="updatePreview()" placeholder="e.g., National Malaria Control Programme">
                                </div>
                            </div>
                            
                            <div class="form-section">
                                <div class="section-label">
                                    <span class="section-number">2</span>
                                    <span class="section-text">Voucher Details</span>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">Voucher Title</label>
                                        <input type="text" class="form-input" id="voucherTitle" oninput="updatePreview()" placeholder="e.g., ITN Campaign ID">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Voucher Code</label>
                                        <input type="text" class="form-input" id="voucherCode" oninput="updatePreview()" placeholder="e.g., ITN-001">
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">Name / Primary Text</label>
                                        <input type="text" class="form-input" id="voucherValue" oninput="updatePreview()" placeholder="e.g., Mohamed Kamara">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Valid Until</label>
                                        <input type="text" class="form-input" id="validUntil" oninput="updatePreview()" placeholder="e.g., Dec 31, 2025">
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">Description / Role</label>
                                        <input type="text" class="form-input" id="voucherDesc" oninput="updatePreview()" placeholder="e.g., Enumerator - Bo District">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Terms / Notes</label>
                                        <input type="text" class="form-input" id="terms" oninput="updatePreview()" placeholder="e.g., Non-transferable">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-section">
                                <div class="section-label">
                                    <span class="section-number">3</span>
                                    <span class="section-text">QR Code</span>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">QR Code Content (URL or Text)</label>
                                    <input type="text" class="form-input" id="qrContent" oninput="updatePreview()" placeholder="e.g., https://verify.example.com/ITN-001">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Batch Tab -->
                        <div id="batchTab" class="tab-content">
                            <div class="form-section">
                                <div class="section-label">
                                    <span class="section-number">1</span>
                                    <span class="section-text">Upload Logo</span>
                                </div>
                                
                                <div class="form-group">
                                    <div class="logo-upload-area">
                                        <div class="logo-preview-box" id="batchLogoPreviewBox">
                                            <span class="logo-placeholder" id="batchLogoPlaceholder">LOGO<small>.png</small></span>
                                            <img id="batchLogoPreviewImg" src="" alt="Logo" style="display: none;">
                                        </div>
                                        <div style="flex: 1;">
                                            <input type="file" id="batchLogoUpload" accept="image/*" onchange="handleBatchLogoUpload(event)" style="display: none;">
                                            <button class="btn btn-secondary btn-block" onclick="document.getElementById('batchLogoUpload').click()">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12"/></svg>
                                                Select Logo
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-section">
                                <div class="section-label">
                                    <span class="section-number">2</span>
                                    <span class="section-text">Upload Excel Data</span>
                                </div>
                                
                                <div class="upload-zone" id="excelDropZone" onclick="document.getElementById('excelUpload').click()">
                                    <div class="upload-icon">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                                            <polyline points="14,2 14,8 20,8"/>
                                            <line x1="16" y1="13" x2="8" y2="13"/>
                                            <line x1="16" y1="17" x2="8" y2="17"/>
                                            <polyline points="10,9 9,9 8,9"/>
                                        </svg>
                                    </div>
                                    <div class="upload-text">
                                        <strong>Click to upload</strong> or drag and drop<br>
                                        Excel file (.xlsx, .xls)
                                    </div>
                                    <input type="file" id="excelUpload" accept=".xlsx,.xls" onchange="handleExcelUpload(event)" style="display: none;">
                                </div>
                                
                                <button class="btn btn-secondary btn-block" onclick="downloadTemplate()" style="margin-top: 12px;">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>
                                    Download Excel Template (20 Samples)
                                </button>
                                
                                <div id="dataPreviewContainer" style="display: none;">
                                    <div class="data-count" id="dataCount"></div>
                                    <div class="data-preview" id="dataPreview"></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Style Settings (Common) -->
                        <div class="form-section" style="margin-top: 8px;">
                            <div class="section-label">
                                <span class="section-number">4</span>
                                <span class="section-text">Design Style</span>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Template</label>
                                <div class="template-grid">
                                    <button class="template-btn active" onclick="setTemplate('classic', event)">Classic</button>
                                    <button class="template-btn" onclick="setTemplate('modern', event)">Modern</button>
                                    <button class="template-btn" onclick="setTemplate('elegant', event)">Elegant</button>
                                    <button class="template-btn" onclick="setTemplate('corporate', event)">Corporate</button>
                                    <button class="template-btn" onclick="setTemplate('minimal', event)">Minimal</button>
                                </div>
                                <div class="template-grid" style="margin-top: 8px;">
                                    <button class="template-btn" onclick="setTemplate('health', event)">Health</button>
                                    <button class="template-btn" onclick="setTemplate('official', event)">Official</button>
                                    <button class="template-btn" onclick="setTemplate('gradient', event)">Gradient</button>
                                    <button class="template-btn" onclick="setTemplate('campaign', event)">Campaign</button>
                                    <button class="template-btn" onclick="setTemplate('badge', event)">Badge</button>
                                </div>
                                <div class="template-grid" style="margin-top: 8px;">
                                    <button class="template-btn" onclick="setTemplate('premium', event)">Premium</button>
                                    <button class="template-btn" onclick="setTemplate('wave', event)">Wave</button>
                                    <button class="template-btn" onclick="setTemplate('stripe', event)">Stripe</button>
                                    <button class="template-btn" onclick="setTemplate('split', event)">Split</button>
                                    <button class="template-btn" onclick="setTemplate('rounded', event)">Rounded</button>
                                </div>
                            </div>
                            
                            <div class="form-group" style="margin-top: 14px;">
                                <label class="form-label">Colors</label>
                                <div class="color-row">
                                    <div class="color-item">
                                        <input type="color" class="color-picker" id="primaryColor" value="#004080" onchange="updatePreview()">
                                        <span class="color-label">Primary</span>
                                    </div>
                                    <div class="color-item">
                                        <input type="color" class="color-picker" id="secondaryColor" value="#ffc107" onchange="updatePreview()">
                                        <span class="color-label">Secondary</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Right Panel - Preview -->
            <div class="preview-panel">
                <div class="card preview-card">
                    <div class="card-header">
                        <div class="card-icon">P</div>
                        <span class="card-title">Live Preview</span>
                    </div>
                    <div class="card-body">
                        <div class="preview-area">
                            <div class="voucher template-classic" id="voucherPreview" style="--primary-color: #004080; --secondary-color: #ffc107;">
                            </div>
                        </div>
                        
                        <div id="singleDownloadButtons" class="download-buttons">
                            <button class="btn btn-gold" onclick="downloadVoucher('png')">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>
                                Download PNG
                            </button>
                            <button class="btn btn-secondary" onclick="downloadVoucher('jpeg')">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>
                                Download JPEG
                            </button>
                        </div>
                        
                        <div id="batchDownloadButtons" class="download-buttons" style="display: none;">
                            <button class="btn btn-success btn-block" onclick="generatePDF()">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14,2 14,8 20,8"/></svg>
                                Generate PDF (A4 - 10 per page)
                            </button>
                        </div>
                        
                        <div id="progressContainer" class="progress-container">
                            <div class="progress-bar">
                                <div class="progress-fill" id="progressFill" style="width: 0%;"></div>
                            </div>
                            <div class="progress-text" id="progressText">Generating vouchers...</div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- Footer -->
        <footer class="app-footer">
            <h4>Informatics Consultancy Firm - Sierra Leone (ICF-SL)</h4>
            <p>Driving Data-Driven Solutions for Health and Development</p>
            <p class="copyright"> 2025 ICF-SL. All rights reserved.</p>
        </footer>
    </div>
    
    <div class="notification" id="notification"></div>
    <div id="renderArea"></div>
    
    <script>
        let currentTemplate = 'classic';
        let uploadedLogo = null;
        let batchLogo = null;
        let excelData = [];
        let currentTab = 'single';

        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            if (tab === 'single') {
                document.querySelectorAll('.tab')[0].classList.add('active');
                document.getElementById('singleTab').classList.add('active');
                document.getElementById('singleDownloadButtons').style.display = 'flex';
                document.getElementById('batchDownloadButtons').style.display = 'none';
            } else {
                document.querySelectorAll('.tab')[1].classList.add('active');
                document.getElementById('batchTab').classList.add('active');
                document.getElementById('singleDownloadButtons').style.display = 'none';
                document.getElementById('batchDownloadButtons').style.display = excelData.length > 0 ? 'flex' : 'none';
            }
            updatePreview();
        }

        function handleLogoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                uploadedLogo = e.target.result;
                document.getElementById('logoPlaceholder').style.display = 'none';
                const previewImg = document.getElementById('logoPreviewImg');
                previewImg.src = uploadedLogo;
                previewImg.style.display = 'block';
                document.getElementById('logoPreviewBox').classList.add('has-logo');
                updatePreview();
                showNotification('Logo uploaded successfully!', 'success');
            };
            reader.readAsDataURL(file);
        }

        function handleBatchLogoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                batchLogo = e.target.result;
                document.getElementById('batchLogoPlaceholder').style.display = 'none';
                const previewImg = document.getElementById('batchLogoPreviewImg');
                previewImg.src = batchLogo;
                previewImg.style.display = 'block';
                document.getElementById('batchLogoPreviewBox').classList.add('has-logo');
                updatePreview();
                showNotification('Logo uploaded successfully!', 'success');
            };
            reader.readAsDataURL(file);
        }

        function handleExcelUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                    
                    if (jsonData.length === 0) {
                        showNotification('Excel file is empty', 'error');
                        return;
                    }
                    
                    excelData = jsonData;
                    displayDataPreview();
                    document.getElementById('batchDownloadButtons').style.display = 'flex';
                    
                    if (excelData.length > 0) {
                        updatePreviewFromData(excelData[0]);
                    }
                    
                    showNotification(`Loaded ${excelData.length} records successfully!`, 'success');
                } catch (error) {
                    showNotification('Error reading Excel file', 'error');
                    console.error(error);
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function displayDataPreview() {
            const container = document.getElementById('dataPreviewContainer');
            const preview = document.getElementById('dataPreview');
            const count = document.getElementById('dataCount');
            
            container.style.display = 'block';
            count.innerHTML = `<strong>${excelData.length}</strong> vouchers to generate (${Math.ceil(excelData.length / 10)} pages)`;
            
            const headers = Object.keys(excelData[0]);
            let html = '<table><thead><tr>';
            headers.forEach(h => html += `<th>${h}</th>`);
            html += '</tr></thead><tbody>';
            
            excelData.slice(0, 8).forEach(row => {
                html += '<tr>';
                headers.forEach(h => html += `<td>${row[h] || ''}</td>`);
                html += '</tr>';
            });
            
            if (excelData.length > 8) {
                html += `<tr><td colspan="${headers.length}" style="text-align: center; color: #999; font-style: italic;">... and ${excelData.length - 8} more records</td></tr>`;
            }
            
            html += '</tbody></table>';
            preview.innerHTML = html;
        }

        function downloadTemplate() {
            // 20 sample entries with Sierra Leone ITN Mass Campaign names and positions
            const template = [
                { company_name: 'National Malaria Control Programme', voucher_code: 'ITN-WA-001', voucher_title: 'ITN Campaign ID', name_text: 'Mohamed Sillah Kanu', valid_until: 'Dec 31, 2025', description: 'District Coordinator - Western Area', terms: 'Official Use Only', qr_content: 'https://itn.gov.sl/verify/ITN-WA-001' },
                { company_name: 'National Malaria Control Programme', voucher_code: 'ITN-WA-002', voucher_title: 'ITN Campaign ID', name_text: 'Fatmata Bangura', valid_until: 'Dec 31, 2025', description: 'Supervisor - Freetown East', terms: 'Official Use Only', qr_content: 'https://itn.gov.sl/verify/ITN-WA-002' },
                { company_name: 'National Malaria Control Programme', voucher_code: 'ITN-BO-001', voucher_title: 'ITN Campaign ID', name_text: 'Abubakar Sesay', valid_until: 'Dec 31, 2025', description: 'Enumerator - Bo District', terms: 'Official Use Only', qr_content: 'https://itn.gov.sl/verify/ITN-BO-001' },
                { company_name: 'National Malaria Control Programme', voucher_code: 'ITN-BO-002', voucher_title: 'ITN Campaign ID', name_text: 'Mariama Koroma', valid_until: 'Dec 31, 2025', description: 'Team Leader - Bo Town', terms: 'Official Use Only', qr_content: 'https://itn.gov.sl/verify/ITN-BO-002' },
                { company_name: 'National Malaria Control Programme', voucher_code: 'ITN-KE-001', voucher_title: 'ITN Campaign ID', name_text: 'Ibrahim Conteh', valid_until: 'Dec 31, 2025', description: 'Distribution Point Manager - Kenema', terms: 'Official Use Only', qr_content: 'https://itn.gov.sl/verify/ITN-KE-001' },
                { company_name: 'National Malaria Control Programme', voucher_code: 'ITN-KE-002', voucher_title: 'ITN Campaign ID', name_text: 'Aminata Turay', valid_until: 'Dec 31, 2025', description: 'Data Clerk - Kenema District', terms: 'Official Use Only', qr_content: 'https://itn.gov.sl/verify/ITN-KE-002' },
                { company_name: 'National Malaria Control Programme', voucher_code: 'ITN-MA-001', voucher_title: 'ITN Campaign ID', name_text: 'Alie Mansaray', valid_until: 'Dec 31, 2025', description: 'Ward Supervisor - Makeni', terms: 'Official Use Only', qr_content: 'https://itn.gov.sl/verify/ITN-MA-001' },
                { company_name: 'National Malaria Control Programme', voucher_code: 'ITN-MA-002', voucher_title: 'ITN Campaign ID', name_text: 'Hawa Kargbo', valid_until: 'Dec 31, 2025', description: 'Community Health Worker - Bombali', terms: 'Official Use Only', qr_content: 'https://itn.gov.sl/verify/ITN-MA-002' },
                { company_name: 'National Malaria Control Programme', voucher_code: 'ITN-PO-001', voucher_title: 'ITN Campaign ID', name_text: 'Foday Bah', valid_until: 'Dec 31, 2025', description: 'Chiefdom Supervisor - Port Loko', terms: 'Official Use Only', qr_content: 'https://itn.gov.sl/verify/ITN-PO-001' },
                { company_name: 'National Malaria Control Programme', voucher_code: 'ITN-PO-002', voucher_title: 'ITN Campaign ID', name_text: 'Adama Jalloh', valid_until: 'Dec 31, 2025', description: 'Logistics Officer - Port Loko', terms: 'Official Use Only', qr_content: 'https://itn.gov.sl/verify/ITN-PO-002' },
                { company_name: 'National Malaria Control Programme', voucher_code: 'ITN-KO-001', voucher_title: 'ITN Campaign ID', name_text: 'Lansana Dumbuya', valid_until: 'Dec 31, 2025', description: 'M&E Officer - Kono District', terms: 'Official Use Only', qr_content: 'https://itn.gov.sl/verify/ITN-KO-001' },
                { company_name: 'National Malaria Control Programme', voucher_code: 'ITN-KO-002', voucher_title: 'ITN Campaign ID', name_text: 'Isata Fofanah', valid_until: 'Dec 31, 2025', description: 'Enumerator - Koidu Town', terms: 'Official Use Only', qr_content: 'https://itn.gov.sl/verify/ITN-KO-002' },
                { company_name: 'National Malaria Control Programme', voucher_code: 'ITN-KA-001', voucher_title: 'ITN Campaign ID', name_text: 'Sorie Kamara', valid_until: 'Dec 31, 2025', description: 'Regional Coordinator - Kailahun', terms: 'Official Use Only', qr_content: 'https://itn.gov.sl/verify/ITN-KA-001' },
                { company_name: 'National Malaria Control Programme', voucher_code: 'ITN-KA-002', voucher_title: 'ITN Campaign ID', name_text: 'Kadiatu Sheriff', valid_until: 'Dec 31, 2025', description: 'Mobilizer - Kailahun District', terms: 'Official Use Only', qr_content: 'https://itn.gov.sl/verify/ITN-KA-002' },
                { company_name: 'National Malaria Control Programme', voucher_code: 'ITN-TO-001', voucher_title: 'ITN Campaign ID', name_text: 'Brima Tarawally', valid_until: 'Dec 31, 2025', description: 'Driver - Tonkolili District', terms: 'Official Use Only', qr_content: 'https://itn.gov.sl/verify/ITN-TO-001' },
                { company_name: 'National Malaria Control Programme', voucher_code: 'ITN-TO-002', voucher_title: 'ITN Campaign ID', name_text: 'Zainab Sesay', valid_until: 'Dec 31, 2025', description: 'Supervisor - Magburaka', terms: 'Official Use Only', qr_content: 'https://itn.gov.sl/verify/ITN-TO-002' },
                { company_name: 'National Malaria Control Programme', voucher_code: 'ITN-PU-001', voucher_title: 'ITN Campaign ID', name_text: 'Amadu Koroma', valid_until: 'Dec 31, 2025', description: 'NMCP Officer - Pujehun', terms: 'Official Use Only', qr_content: 'https://itn.gov.sl/verify/ITN-PU-001' },
                { company_name: 'National Malaria Control Programme', voucher_code: 'ITN-PU-002', voucher_title: 'ITN Campaign ID', name_text: 'Memuna Bangura', valid_until: 'Dec 31, 2025', description: 'Enumerator - Pujehun Town', terms: 'Official Use Only', qr_content: 'https://itn.gov.sl/verify/ITN-PU-002' },
                { company_name: 'National Malaria Control Programme', voucher_code: 'ITN-MO-001', voucher_title: 'ITN Campaign ID', name_text: 'Komba Conteh', valid_until: 'Dec 31, 2025', description: 'Team Leader - Moyamba District', terms: 'Official Use Only', qr_content: 'https://itn.gov.sl/verify/ITN-MO-001' },
                { company_name: 'National Malaria Control Programme', voucher_code: 'ITN-MO-002', voucher_title: 'ITN Campaign ID', name_text: 'Finda Turay', valid_until: 'Dec 31, 2025', description: 'Data Clerk - Moyamba Junction', terms: 'Official Use Only', qr_content: 'https://itn.gov.sl/verify/ITN-MO-002' }
            ];
            
            const ws = XLSX.utils.json_to_sheet(template);
            
            // Set column widths
            ws['!cols'] = [
                { wch: 30 }, // company_name
                { wch: 14 }, // voucher_code
                { wch: 16 }, // voucher_title
                { wch: 22 }, // name_text
                { wch: 14 }, // valid_until
                { wch: 32 }, // description
                { wch: 18 }, // terms
                { wch: 40 }  // qr_content
            ];
            
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Vouchers');
            XLSX.writeFile(wb, 'itn_campaign_voucher_template.xlsx');
            showNotification('Template downloaded with 20 sample entries!', 'success');
        }

        function getLogoSrc() {
            if (currentTab === 'batch') {
                return batchLogo || '';
            }
            return uploadedLogo || '';
        }

        function setTemplate(template, evt) {
            currentTemplate = template;
            document.querySelectorAll('.template-btn').forEach(btn => btn.classList.remove('active'));
            if (evt && evt.target) evt.target.classList.add('active');
            updatePreview();
        }

        function updatePreviewFromData(data) {
            document.getElementById('companyName').value = data.company_name || '';
            document.getElementById('voucherCode').value = data.voucher_code || '';
            document.getElementById('voucherTitle').value = data.voucher_title || '';
            document.getElementById('voucherValue').value = data.name_text || '';
            document.getElementById('validUntil').value = data.valid_until || '';
            document.getElementById('voucherDesc').value = data.description || '';
            document.getElementById('terms').value = data.terms || '';
            document.getElementById('qrContent').value = data.qr_content || '';
            updatePreview();
        }

        function updatePreview() {
            const voucher = document.getElementById('voucherPreview');
            const primaryColor = document.getElementById('primaryColor').value;
            const secondaryColor = document.getElementById('secondaryColor').value;
            
            voucher.style.setProperty('--primary-color', primaryColor);
            voucher.style.setProperty('--secondary-color', secondaryColor);
            voucher.className = `voucher template-${currentTemplate}`;
            
            const companyName = document.getElementById('companyName').value || 'Institution Name';
            const voucherTitle = document.getElementById('voucherTitle').value || 'Voucher Title';
            const voucherValue = document.getElementById('voucherValue').value || 'Recipient Name';
            const voucherCode = document.getElementById('voucherCode').value || 'CODE-001';
            const voucherDesc = document.getElementById('voucherDesc').value || 'Description / Role';
            const validUntil = document.getElementById('validUntil').value || 'Valid Until';
            const terms = document.getElementById('terms').value || 'Terms';
            const qrContent = document.getElementById('qrContent').value || 'https://example.com';
            
            renderVoucher(voucher, {
                companyName, voucherTitle, voucherValue, voucherCode,
                voucherDesc, validUntil, terms, qrContent
            }, getLogoSrc(), primaryColor);
        }

        function renderVoucher(container, data, logoSrc, primaryColor) {
            const logoHtml = logoSrc 
                ? `<div class="voucher-logo"><img src="${logoSrc}" alt="Logo"></div>` 
                : `<div class="voucher-logo" style="background: rgba(255,255,255,0.95); font-size: 6px; color: #004080; font-weight: 700; display: flex; flex-direction: column; align-items: center; justify-content: center; line-height: 1.2;"><span>LOGO</span><span style="font-size: 5px; opacity: 0.7;">.png</span></div>`;
            
            const html = `
                <div class="voucher-header">
                    ${logoHtml}
                    <div class="voucher-institution">${data.companyName}</div>
                </div>
                <div class="voucher-body">
                    <div class="voucher-title">${data.voucherTitle}</div>
                    <div class="voucher-name">${data.voucherValue}</div>
                    <div class="voucher-desc">${data.voucherDesc}</div>
                    <div class="voucher-footer">
                        <span>${data.validUntil}</span>
                        <span>${data.terms}</span>
                    </div>
                </div>
                <div class="voucher-qr">
                    <div class="qr-wrapper"><div class="qr-code-container"></div></div>
                    <div class="qr-label">Scan to Verify</div>
                    <div class="voucher-code">${data.voucherCode}</div>
                </div>
            `;
            
            container.innerHTML = html;
            
            const qrContainer = container.querySelector('.qr-code-container');
            if (qrContainer && data.qrContent) {
                new QRCode(qrContainer, {
                    text: data.qrContent,
                    width: 50,
                    height: 50,
                    colorDark: primaryColor,
                    colorLight: '#ffffff',
                    correctLevel: QRCode.CorrectLevel.M
                });
            }
        }

        async function downloadVoucher(format) {
            const voucher = document.getElementById('voucherPreview');
            
            try {
                showNotification('Generating image...', 'success');
                
                const canvas = await html2canvas(voucher, {
                    scale: 3,
                    useCORS: true,
                    allowTaint: true,
                    backgroundColor: format === 'jpeg' ? '#ffffff' : null
                });
                
                const link = document.createElement('a');
                link.download = `voucher_${Date.now()}.${format}`;
                link.href = canvas.toDataURL(`image/${format}`, 0.95);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showNotification(`Downloaded as ${format.toUpperCase()}!`, 'success');
            } catch (error) {
                showNotification('Error generating image.', 'error');
                console.error(error);
            }
        }

        async function generatePDF() {
            if (excelData.length === 0) {
                showNotification('No data loaded. Please upload Excel file.', 'error');
                return;
            }
            
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('p', 'mm', 'a4');
            
            const pageWidth = 210;
            const pageHeight = 297;
            const margin = 10;
            const voucherWidth = (pageWidth - margin * 3) / 2;
            const voucherHeight = (pageHeight - margin * 6) / 5;
            
            const renderArea = document.getElementById('renderArea');
            const primaryColor = document.getElementById('primaryColor').value;
            const secondaryColor = document.getElementById('secondaryColor').value;
            const logoSrc = batchLogo || '';
            
            document.getElementById('progressContainer').style.display = 'block';
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            
            let voucherIndex = 0;
            
            for (let i = 0; i < excelData.length; i++) {
                const row = excelData[i];
                const data = {
                    companyName: row.company_name || '',
                    voucherCode: row.voucher_code || '',
                    voucherTitle: row.voucher_title || '',
                    voucherValue: row.name_text || '',
                    validUntil: row.valid_until || '',
                    voucherDesc: row.description || '',
                    terms: row.terms || '',
                    qrContent: row.qr_content || ''
                };
                
                const voucherEl = document.createElement('div');
                voucherEl.className = `voucher template-${currentTemplate}`;
                voucherEl.style.cssText = `--primary-color: ${primaryColor}; --secondary-color: ${secondaryColor};`;
                renderArea.appendChild(voucherEl);
                
                renderVoucher(voucherEl, data, logoSrc, primaryColor);
                
                await new Promise(resolve => setTimeout(resolve, 100));
                
                const canvas = await html2canvas(voucherEl, {
                    scale: 2,
                    useCORS: true,
                    allowTaint: true,
                    backgroundColor: '#ffffff'
                });
                
                const col = voucherIndex % 2;
                const rowNum = Math.floor(voucherIndex / 2) % 5;
                
                if (voucherIndex > 0 && voucherIndex % 10 === 0) {
                    pdf.addPage();
                }
                
                const x = margin + col * (voucherWidth + margin);
                const y = margin + rowNum * (voucherHeight + margin);
                
                const imgData = canvas.toDataURL('image/jpeg', 0.95);
                pdf.addImage(imgData, 'JPEG', x, y, voucherWidth, voucherHeight);
                
                renderArea.removeChild(voucherEl);
                voucherIndex++;
                
                const progress = Math.round((i + 1) / excelData.length * 100);
                progressFill.style.width = progress + '%';
                progressText.textContent = `Generating voucher ${i + 1} of ${excelData.length}...`;
            }
            
            progressText.textContent = 'Saving PDF...';
            pdf.save(`vouchers_${Date.now()}.pdf`);
            
            document.getElementById('progressContainer').style.display = 'none';
            showNotification(`PDF generated with ${excelData.length} vouchers!`, 'success');
        }

        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            setTimeout(() => { notification.className = 'notification'; }, 3000);
        }

        // Drag and drop for Excel
        const dropZone = document.getElementById('excelDropZone');
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });
        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('dragover');
        });
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file && (file.name.endsWith('.xlsx') || file.name.endsWith('.xls'))) {
                document.getElementById('excelUpload').files = e.dataTransfer.files;
                handleExcelUpload({ target: { files: [file] } });
            } else {
                showNotification('Please upload an Excel file (.xlsx, .xls)', 'error');
            }
        });

        // Initialize preview on load
        document.addEventListener('DOMContentLoaded', updatePreview);
    </script>
</body>
</html>
